<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Альбом</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Библиотека для чтения ID3-тегов -->
  <script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      display: flex;
      justify-content: center;
    }
    .album-container {
      max-width: 800px;
      width: 100%;
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    .album-header { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .album-author { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.1em; color: #777; }
    .album-title { font-size: 1.6rem; margin: 5px 0 10px; font-weight: 600; }
    .album-description { font-size: 0.9rem; color: #555; }

    .album-body { display: flex; flex-wrap: wrap; gap: 20px; }

    .playlist {
      flex: 1 1 240px;
      margin: 0;
      padding: 0;
      list-style: none;
      border-radius: 10px;
      background: #fafafa;
      border: 1px solid #eee;
      max-height: 300px;
      overflow-y: auto;
    }
    .playlist li {
      padding: 10px 14px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      font-size: 0.95rem;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .playlist li:last-child { border-bottom: none; }
    .track-number { width: 22px; text-align: right; color: #aaa; font-size: 0.85rem; flex-shrink: 0; }
    .track-title { flex: 1; }
    .playlist li:hover { background: #f0f4ff; }
    .playlist li.active { background: #dfe8ff; font-weight: 600; }

    .player-block {
      flex: 1 1 260px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .now-playing-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #999;
    }
    .now-playing-title { font-size: 1.05rem; font-weight: 600; margin-bottom: 4px; }
    .hint { font-size: 0.8rem; color: #999; }

    audio { width: 100%; margin-top: 10px; }

    @media (max-width: 640px) {
      .album-body { flex-direction: column; }
      .album-container { padding: 15px; }
    }
  </style>
</head>
<body>

<div class="album-container">
  <header class="album-header">
    <!-- Эти поля мы тоже можем заполнить из тегов первого трека -->
    <div id="album-author" class="album-author">Автор альбома: <strong>—</strong></div>
    <h1 id="album-title" class="album-title">Название альбома</h1>
    <p class="album-description">
      Страница альбома. Названия песен и автор подтягиваются из тегов MP3-файлов.
    </p>
  </header>

  <div class="album-body">
    <!-- Плейлист будем заполнять через JS -->
    <ul id="playlist" class="playlist"></ul>

    <!-- Плеер -->
    <div class="player-block">
      <div>
        <div class="now-playing-label">Сейчас играет</div>
        <div id="now-playing" class="now-playing-title">—</div>
        <div class="hint">
          Если воспроизведение не началось автоматически, нажмите кнопку «Play».
        </div>
      </div>

      <audio id="audio-player" controls>
        Ваш браузер не поддерживает воспроизведение аудио.
      </audio>
    </div>
  </div>
</div>

<script>
  // Список файлов MP3 в альбоме
  const tracks = [
    { src: '001 Ашкынам мин туган ягыма.mp3' },
    { src: '002 Кокпар.mp3' },
    { src: '003 Истамбул.mp3' }
  ];

  const playlistEl = document.getElementById('playlist');
  const audio = document.getElementById('audio-player');
  const nowPlayingEl = document.getElementById('now-playing');
  const albumAuthorEl = document.getElementById('album-author');
  const albumTitleEl = document.getElementById('album-title');

  let playlistItems = [];
  let currentIndex = 0;

  // Чтение тегов одного файла
  function readTags(track, index) {
    if (!window.jsmediatags) {
      console.warn('jsmediatags не загружен');
      return;
    }

    jsmediatags.read(track.src, {
      onSuccess: function(tag) {
        const t = tag.tags || {};
        const title = t.title || ('Трек ' + (index + 1));
        const artist = t.artist || 'Неизвестный автор';
        const album = t.album || 'Без названия';

        // Сохраняем распарсенные данные в объекте трека
        track.title = title;
        track.artist = artist;
        track.album = album;

        // Если это первый трек — заполним автора и название альбома
        if (index === 0) {
          albumAuthorEl.innerHTML = 'Автор альбома: <strong>' + artist + '</strong>';
          albumTitleEl.textContent = album;
        }

        // Обновляем текст в плейлисте (если элемент уже создан)
        const li = playlistItems[index];
        if (li) {
          li.querySelector('.track-title').textContent = title;
        }
      },
      onError: function(error) {
        console.log('Ошибка чтения тегов для', track.src, error);
      }
    });
  }

  // Инициализация списка треков
  function buildPlaylist() {
    tracks.forEach((track, index) => {
      const li = document.createElement('li');
      li.dataset.index = index;
      li.innerHTML = `
        <span class="track-number">${index + 1}</span>
        <span class="track-title">Загрузка...</span>
      `;
      li.addEventListener('click', () => {
        loadTrack(index, true);
      });
      playlistEl.appendChild(li);
      playlistItems[index] = li;

      // Читаем ID3-теги для этого трека
      readTags(track, index);
    });
  }

  function setActive(index) {
    playlistItems.forEach((li, i) => {
      li.classList.toggle('active', i === index);
    });
  }

  function loadTrack(index, autoplay = false) {
    if (index < 0 || index >= tracks.length) return;
    currentIndex = index;

    const track = tracks[index];
    const title = track.title || ('Трек ' + (index + 1));
    nowPlayingEl.textContent = title;

    audio.src = track.src;
    setActive(index);

    if (autoplay) {
      const playPromise = audio.play();
      if (playPromise) {
        playPromise.catch(err => {
          console.log('Autoplay blocked:', err);
        });
      }
    }
  }

  // Переход на следующий трек после окончания
  audio.addEventListener('ended', () => {
    const nextIndex = (currentIndex + 1) % tracks.length; // зацикливаем
    loadTrack(nextIndex, true);
  });

  document.addEventListener('DOMContentLoaded', () => {
    buildPlaylist();
    if (tracks.length > 0) {
      loadTrack(0, true); // первый трек
    }
  });
</script>

</body>
</html>
